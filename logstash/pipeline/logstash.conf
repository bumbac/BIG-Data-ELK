 input {
	file {
		path => "/usr/share/logstash/data/osoby.csv"
		start_position => "beginning"
	}
}

filter {
   grok {
      match => {
         "message" => "%{CUSTOM_DATE:datum},%{INT:vek},%{NO_COMA:pohlavi},%{NO_COMA:kraj_nuts_kod},%{NO_COMA:okres_lau_kod},%{NO_COMA:nakaza_v_zahranici},%{NO_COMA:nakaza_zeme_csu_kod}"
      }
      pattern_definitions => {
         "CUSTOM_DATE" => "%{YEAR}-%{MONTHNUM}-%{MONTHDAY}"
         "NO_COMA" => "[^,]*"
      }
   }
   mutate {
      add_field => {
         "timestamp" => "{%{datum}}"
      }
   }
   date {
        match => [ "datum", "yyyy-MM-dd" ]
        target => "time_filterr"
   }
   mutate {
      convert => {
         "vek" => "integer"
      }
   }
   mutate{
      convert => {
         "nakaza_v_zahranici" => "string"
      }
   }
   mutate {
      convert => {
         "nakaza_v_zahranici" => "boolean"
      }
   }

}

output {
	elasticsearch {
		hosts => "elasticsearch:9200"
		index => "osoby"
		template => "/usr/share/logstash/template/osoby_template.json"
		template_name => "osoby_elastic"
		template_overwrite => true
		manage_template => true
	}
}
